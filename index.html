<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>YUAIDJs –ì–∏–¥—Ä–∞—Ü–∏—è!</title>

  <!-- üéõÔ∏è –ü–æ–¥–∫–ª—é—á–∞–µ–º –¥–µ–∫–æ–¥–µ—Ä –±–∏–Ω–∞—Ä–Ω—ã—Ö –±–∏—Ç–æ–≤ (MessagePack) ‚Äî –¥–ª—è —á—ë—Ç–∫–∏—Ö WebSocket –º–∏–∫—Å–æ–≤! -->
  <script src="https://unpkg.com/@msgpack/msgpack@2.8.0/dist/msgpack.min.js"></script>

  <script>
    // üé∂ –ü–µ—Ä–≤—ã–π –±–∏—Ç –≤–µ—á–µ—Ä–∏–Ω–∫–∏ ‚Äî —ç—Ç–æ –¥–∞–Ω–Ω—ã–µ, –ø—Ä–∏—à–µ–¥—à–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–∞ (SSR pre-render)!
    window.__INITIAL_DATA__ = {
      pirates: [
        { "p.name": "–õ–∏—Ö–æ–π –ò–≤–∞–Ω", "s.name": "–ß—ë—Ä–Ω–∞—è –∫–æ–º–µ—Ç–∞" },
        { "p.name": "–î–∂–µ–∫ –í–æ—Ä–æ–±–æ—Ç", "s.name": "–ì–∞–ª–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —à—Ç–æ—Ä–º" }
      ]
    };
  </script>
</head>
<body>
  <!-- üß≠ –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å—Ü–µ–Ω–∞–º —Ñ–µ—Å—Ç–∏–≤–∞–ª—è ‚Äî –∫–∞–∂–¥—ã–π –ø—É–Ω–∫—Ç –≤–µ–¥—ë—Ç –∫ –Ω–æ–≤–æ–º—É API-–∑–∞–ø—Ä–æ—Å—É -->
  <nav>
    <a href="/" data-link>–ü–∏—Ä–∞—Ç—ã</a>
    <a href="/ships" data-link>–ö–æ—Ä–∞–±–ª–∏</a>
  </nav>

  <!-- üé§ –ì–ª–∞–≤–Ω–∞—è —Å—Ü–µ–Ω–∞, –∫—É–¥–∞ –º—ã –±—É–¥–µ–º –¥—Ä–æ–ø–∞—Ç—å HTML ‚Äî –Ω–∞—à –≤–∏–∑—É–∞–ª—å–Ω—ã–π —Ç–∞–Ω—Ü–ø–æ–ª -->
  <main id="app"></main>

  <script type="module">
    // üéöÔ∏è –ü–æ–¥–∫–ª—é—á–∞–µ–º –¥–∏–¥–∂–µ–π—Å–∫–∏–π –ø—É–ª—å—Ç ‚Äî –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –≥–∏–¥—Ä–∞—Ü–∏—é, —à–∞–±–ª–æ–Ω –∏ —Ä–æ—É—Ç–µ—Ä!
    import {
      hydrateComponent,
      pirateTemplate,
      Router
    } from './yuaidjs.hydrate.js';

    // üî• –ù–∞—á–∏–Ω–∞–µ–º –≤–µ—á–µ—Ä–∏–Ω–∫—É! –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º —à–∞–±–ª–æ–Ω –∫ SSR-–¥–∞–Ω–Ω—ã–º –∏ –≥–æ—Ç–æ–≤–∏–º DOM
    const component = hydrateComponent('app', pirateTemplate, {
      pirates: window.__INITIAL_DATA__.pirates
    });

    // üì° –í–∫–ª—é—á–∞–µ–º WebSocket ‚Äî –ø—Ä—è–º–æ–π —ç—Ñ–∏—Ä –¥–∞–Ω–Ω—ã—Ö –∏–∑ –≥–∞–ª–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –∫–ª—É–±–∞!
    component.reactiveData.connectWebSocket('ws://localhost:4000/updates');

    // üó∫Ô∏è –ö–∞—Ä—Ç–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤ ‚Äî –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –æ—Ç–∫—É–¥–∞ –±—Ä–∞—Ç—å –Ω–æ–≤—ã–µ —Ç—Ä–µ–∫–∏ (–¥–∞–Ω–Ω—ã–µ)
    const routes = {
      '/': '/api/pirates',
      '/ships': '/api/ships'
    };

    // üöÄ –î–∏–¥–∂–µ–π —Ä–æ—É—Ç–µ—Ä! –°–ª—É—à–∞–µ–º –ø–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —Å—Ü–µ–Ω–∞–º–∏ –∏ –¥—Ä–æ–ø–∞–µ–º –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
    new Router(routes, (path, data) => {
      component.reactiveData.replace(data); // üíæ –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ real-time
    });
  </script>
<!-- üí° –ü–∞–Ω–µ–ª—å –æ—Ç–ª–∞–¥–∫–∏: –≤–∫–ª—é—á–∞–µ—Ç—Å—è –µ—Å–ª–∏ –≤–∫–ª—é—á—ë–Ω window.YUAIDJs.debug -->
<div id="yuai-debug" style="
  position: fixed;
  bottom: 0;
  right: 0;
  max-width: 400px;
  max-height: 200px;
  overflow: auto;
  background: rgba(0, 0, 0, 0.8);
  color: lime;
  font-family: monospace;
  font-size: 12px;
  padding: 10px;
  z-index: 9999;
  display: none;
"></div>

<script>
  const logDebug = (msg) => {
    if (!window.YUAIDJs?.debug) return;
    const panel = document.getElementById('yuai-debug');
    panel.style.display = 'block';
    const line = document.createElement('div');
    line.textContent = `[YUAIDJs] ${msg}`;
    panel.appendChild(line);
    panel.scrollTop = panel.scrollHeight;
  };

  // üéß –•—É–∫–∞–µ–º—Å—è –≤ WebSocket
  const origConnect = window.YUAIDJs.Reactive.prototype.connectWebSocket;
  window.YUAIDJs.Reactive.prototype.connectWebSocket = function (url) {
    logDebug(`–ü–æ–¥–∫–ª—é—á–∞–µ–º WebSocket: ${url}`);
    return origConnect.call(this, url);
  };

  // üéß –•—É–∫–∞–µ–º—Å—è –≤ Router –ø–µ—Ä–µ—Ö–æ–¥—ã
  const origRouterNav = window.YUAIDJs.Router.prototype.navigate;
  window.YUAIDJs.Router.prototype.navigate = async function (path) {
    logDebug(`–ú–∞—Ä—à—Ä—É—Ç: ${path}`);
    return origRouterNav.call(this, path);
  };
</script>

</body>
</html>
